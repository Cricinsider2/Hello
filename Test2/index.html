<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Auto M3U Player</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/controls.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.ui.min.js"></script>
<style>
html,body{margin:0;padding:0;height:100%;background:#000}
video{width:100%;height:100%;object-fit:contain;background:#000}
.loading{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;background:#000}
</style>
</head>
<body>
<div class="loading" id="loading">Loadingâ€¦</div>
<video id="video" autoplay muted playsinline></video>
<script>
const M3U_URL = "https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/jstar.m3u";

async function fetchText(url){
  let r = await fetch(url);
  if(!r.ok){
    const prox = 'https://api.allorigins.win/get?url='+encodeURIComponent(url);
    const p = await fetch(prox);
    const j = await p.json();
    return j.contents;
  }
  return await r.text();
}

// very simple parser: grabs the first http(s) line
function parseM3U(txt){
  const lines = txt.split(/\r?\n/).map(l=>l.trim()).filter(l=>l && !l.startsWith("#"));
  return lines[0];
}

async function init(){
  const loading = document.getElementById("loading");
  const video = document.getElementById("video");

  if(!shaka.Player.isBrowserSupported()){
    loading.textContent = "Browser not supported";
    return;
  }
  shaka.polyfill.installAll();
  const player = new shaka.Player(video);
  new shaka.ui.Overlay(player, document.body, video);

  player.addEventListener('error', e=>{
    console.error("Shaka error:", e.detail);
    loading.textContent = "Playback error";
  });

  try{
    const txt = await fetchText(M3U_URL);
    const stream = parseM3U(txt);
    if(!stream) throw new Error("No stream URL found");
    await player.load(stream);
    loading.remove();

    // one-time tap to request fullscreen
    const goFull = ()=>{
      if(!document.fullscreenElement){
        document.documentElement.requestFullscreen().catch(()=>{});
      }
      video.play();
      window.removeEventListener("click",goFull);
    };
    window.addEventListener("click",goFull,{once:true});
  }catch(e){
    console.error(e);
    loading.textContent = "Failed: "+e.message;
  }
}
document.addEventListener("DOMContentLoaded",init);
</script>
</body>
</html>