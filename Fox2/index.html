<script type="text/javascript" data-cfasync="false">
(function () {
  var j = window,
    u = "fa25630db48e40b4644200ec88bc5042",
    b = [
      ["siteId", 670 * 360 * 889 + 588 - 209168296],
      ["minBid", 0],
      ["popundersPerIP", "0"],
      ["delayBetween", 0],
      ["default", false],
      ["defaultPerDay", 0],
      ["topmostLayer", "auto"]
    ],
    d = [
      "d3d3LmJldHRlcmFkc3lzdGVtLmNvbS9ocmFjdGl2ZS5taW4uY3Nz",
      "ZDJrazBvM2ZyN2VkMDEuY2xvdWRmcm9udC5uZXQvU2lCRC9ocGxhY2Vob2xkZXIubWluLmpz"
    ],
    g = -1,
    c,
    l,
    v = function () {
      clearTimeout(l);
      g++;
      if (d[g] && !(1798289483000 < new Date().getTime() && 1 < g)) {
        c = j.document.createElement("script");
        c.type = "text/javascript";
        c.async = true;
        var n = j.document.getElementsByTagName("script")[0];
        c.src = "https://" + atob(d[g]);
        c.crossOrigin = "anonymous";
        c.onerror = v;
        c.onload = function () {
          clearTimeout(l);
          j[u.slice(0, 16) + u.slice(0, 16)] || v();
        };
        l = setTimeout(v, 5000);
        n.parentNode.insertBefore(c, n);
      }
    };
  if (!j[u]) {
    try {
      Object.freeze((j[u] = b));
    } catch (e) {}
    v();
  }
})();
</script>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WAPTV PLAYER</title>
  <meta name="referrer" content="no-referrer">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: sans-serif;
    }

    .shaka-video-container {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
</head>

<body>
  <div class="shaka-video-container" id="player-container">
    <video id="video" autoplay playsinline preload="metadata"></video>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const channelId = urlParams.get('id') || '143'; // Fixed here

    let CONFIG = {};

    async function fetchConfig() {
      try {
        const response = await fetch("https://allinonereborn.online/jstrweb2/jstr.json");
        const channels = await response.json();

        const channelData = channels.find(
          c => String(c.channel_id) === String(channelId)
        );

        if (!channelData) {
          alert("Channel ID not found!");
          return false;
        }

        const keyId = Object.keys(channelData.drm)[0];
        const key = channelData.drm[keyId];

        CONFIG = {
          streamUrl: channelData.mpd,
          keyId: keyId,
          key: key,
          token: channelData.token,
          userAgent: channelData.userAgent || 
            'plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6'
        };

        return true;
      } catch (error) {
        console.error("Config Fetch Error:", error);
        return false;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const configLoaded = await fetchConfig();
      if (!configLoaded) return;

      shaka.polyfill.installAll();

      const videoEl = document.getElementById('video');
      const container = document.getElementById('player-container');

      const player = new shaka.Player();
      await player.attach(videoEl);

      new shaka.ui.Overlay(player, container, videoEl);

      player.configure({
        drm: {
          clearKeys: {
            [CONFIG.keyId]: CONFIG.key
          }
        },
        streaming: {
          lowLatencyMode: true
        }
      });

      player.getNetworkingEngine().registerRequestFilter((type, request) => {
        request.headers['Referer'] = 'https://www.jiotv.com/';
        request.headers['User-Agent'] = CONFIG.userAgent;

        if (CONFIG.token) {
          const separator = request.uris[0].includes('?') ? '&' : '?';
          if (!request.uris[0].includes('hdnea')) {
            request.uris[0] += separator + CONFIG.token;
          }
        }
      });

      try {
        await player.load(CONFIG.streamUrl);
      } catch (e) {
        console.error("Playback Error", e);
      }
    });
  </script>
</body>
</html>